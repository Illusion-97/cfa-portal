{"remainingRequest":"C:\\Users\\Admin stagiaire.DESKTOP-8967908\\Desktop\\Projet_CFA\\AppliCFAFront\\cfa-portal\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Admin stagiaire.DESKTOP-8967908\\Desktop\\Projet_CFA\\AppliCFAFront\\cfa-portal\\src\\views\\Admin\\Crud\\User\\AddUser.vue?vue&type=style&index=0&id=7fdcbc4f&scoped=true&lang=css&","dependencies":[{"path":"C:\\Users\\Admin stagiaire.DESKTOP-8967908\\Desktop\\Projet_CFA\\AppliCFAFront\\cfa-portal\\src\\views\\Admin\\Crud\\User\\AddUser.vue","mtime":1634717085394},{"path":"C:\\Users\\Admin stagiaire.DESKTOP-8967908\\Desktop\\Projet_CFA\\AppliCFAFront\\cfa-portal\\node_modules\\css-loader\\index.js","mtime":1634732407337},{"path":"C:\\Users\\Admin stagiaire.DESKTOP-8967908\\Desktop\\Projet_CFA\\AppliCFAFront\\cfa-portal\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1634732415296},{"path":"C:\\Users\\Admin stagiaire.DESKTOP-8967908\\Desktop\\Projet_CFA\\AppliCFAFront\\cfa-portal\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1634732405246},{"path":"C:\\Users\\Admin stagiaire.DESKTOP-8967908\\Desktop\\Projet_CFA\\AppliCFAFront\\cfa-portal\\node_modules\\vue-loader\\lib\\index.js","mtime":1634732415295}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmhlYWRlci1saXN0IHsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKICBtYXJnaW4tYm90dG9tOiAwLjUlOwp9CgouaGVhZGVyLWxpc3Q+Zm9ybSB7CiAgd2lkdGg6IDQwJTsKfQoKLmNpdmlsaXRlIHsKICBmb250LXdlaWdodDogYm9sZDsKICBtYXJnaW4tbGVmdDogMS43ZW07CiAgbWFyZ2luLXJpZ2h0OiAzZW07Cn0KCiNzYWlzaWUgewogIHdpZHRoOiA3MCU7CiAgbWFyZ2luLXJpZ2h0OiA1JTsKfQoKLmNyb2l4LWRlbGV0ZTpob3ZlciB7CiAgY3Vyc29yOiBwb2ludGVyOwp9Cg=="},{"version":3,"sources":["AddUser.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6UA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"AddUser.vue","sourceRoot":"src/views/Admin/Crud/User","sourcesContent":["<template>\r\n  <div class=\"container-fluid\">\r\n    <router-link :to=\"{ name: 'admin_dashboard' }\" class=\"h5\" style=\"cursor:pointer; color:black;text-decoration:none;\">\r\n      <font-awesome-icon :icon=\"['fas', 'chevron-left']\" class=\"icon\" />\r\n      Precedent\r\n    </router-link>\r\n\r\n    <BodyTitle :title=\"vue_title\" />\r\n\r\n    <form @submit=\"submit\">\r\n      <!-- Civilite -->\r\n      <div class=\"form-group\">\r\n        <div class=\"row\">\r\n          <label class=\"civilite\">Civilité : </label>\r\n          <div class=\"form-check col-1\">\r\n            <input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"monsieur\" value=\"M\" checked\r\n              v-model=\"form.civilite\" autocomplete=\"honorific-prefix\" />\r\n            <label class=\"form-check-label\" for=\"monsieur\">\r\n              Monsieur\r\n            </label>\r\n          </div>\r\n          <div class=\"form-check col-1\">\r\n            <input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"madame\" value=\"Mme\"\r\n              v-model=\"form.civilite\" autocomplete=\"honorific-prefix\" />\r\n            <label class=\"form-check-label\" for=\"madame\">\r\n              Madame\r\n            </label>\r\n          </div>\r\n          <div class=\"form-check col-1\">\r\n            <input class=\"form-check-input\" type=\"radio\" name=\"gridRadios\" id=\"mademoiselle\" value=\"Mlle\"\r\n              v-model=\"form.civilite\" autocomplete=\"honorific-prefix\" />\r\n            <label class=\"form-check-label\" for=\"mademoiselle\">\r\n              Mademoiselle\r\n            </label>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      <!-- Nom / Prenom -->\r\n      <div class=\"d-flex justify-content-center\">\r\n        <div class=\"form-group col-6\">\r\n          <label for=\"nom\">Nom</label>\r\n          <input type=\"text\" name=\"nom\" id=\"nom\" class=\"form-control\" placeholder=\"Michel\" v-model=\"form.nom\"\r\n            autocomplete=\"family-name\"/>\r\n        </div>\r\n        <div class=\"form-group col-6\">\r\n          <label for=\"nom\">Prénom</label>\r\n          <input type=\"text\" name=\"prenom\" class=\"form-control\" placeholder=\"Jean\" v-model=\"form.prenom\"\r\n            autocomplete=\"given-name\"/>\r\n        </div>\r\n      </div>\r\n      <!-- Date de naissance / Telephone -->\r\n      <div class=\"d-flex justify-content-center\">\r\n        <div class=\"form-group col-6\">\r\n          <label for=\"nom\">Date de naissance</label>\r\n          <input type=\"text\" name=\"birthdate\" id=\"birth\" class=\"form-control\" placeholder=\"jj/mm/aaaa\"\r\n            v-model=\"form.dateDeNaissance\" pattern=\"[0-9]{2}/[0-9]{2}/[0-9]{4}\" autocomplete=\"bday\"/>\r\n        </div>\r\n        <div class=\"form-group col-6\">\r\n          <label for=\"nom\">Telephone</label>\r\n          <input type=\"tel\" name=\"phone\" class=\"form-control\" placeholder=\"0000000000\" v-model=\"form.telephone\"\r\n            pattern=\"[0-9]{2}[0-9]{2}[0-9]{2}[0-9]{2}[0-9]{2}\" maxlength=\"10\" autocomplete=\"tel\" />\r\n        </div>\r\n      </div>\r\n      <!-- Email -->\r\n      <div class=\"d-flex justify-content-center\">\r\n        <div class=\"form-group col-12\">\r\n          <label for=\"nom\">Email</label>\r\n          <input type=\"email\" name=\"email\" id=\"login\" class=\"form-control\" placeholder=\"jmichel@dawan.fr\"\r\n            v-model=\"form.login\" autocomplete=\"email\" />\r\n          <!-- {{form.prenom[0]+form.nom | lowercase}} -->\r\n        </div>\r\n\r\n        <!-- <div class=\"form-group col-6\">\r\n          <label for=\"nom\">Mot de passe</label>\r\n          <input type=\"password\" name=\"password\" class=\"form-control\" placeholder=\"Mot de passe\"\r\n            v-model=\"form.password\" autocomplete=\"new-password\" @input=\"this.setCustomValidity('')\"/>\r\n        </div> -->\r\n      </div>\r\n      <div class=\"d-flex\">\r\n        <div class=\"form-group col-6\">\r\n          <label for=\"\">Roles : </label>\r\n          <a class=\"\" @click=\"showModal()\" href=\"#\"> Ajouter un role</a>\r\n          <div class=\"mon-group d-flex\" v-if=\"rolesComputed\" id=\"role\">\r\n            <div class=\"alert alert-secondary mr-2 py-1 px-2\" role=\"alert\" v-for=\"(role, index) in rolesComputed\"\r\n              :key=\"role.id\">\r\n              {{ role.intitule }}\r\n              <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\r\n                <span class=\"close\" @click=\"removeFromlist(index)\">&times;</span>\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div class=\"form-group col-6\">\r\n          <label for=\"\">Adresse</label>\r\n          <div class=\"d-flex justify-content-between\">\r\n            <input type=\"number\" name=\"num\" class=\"form-control col-1\" placeholder=\"N°\"\r\n              v-model=\"form.adresseDto.numero\" />\r\n            <input type=\"text\" name=\"rue\" class=\"form-control col-4\" placeholder=\"rue\" v-model=\"form.adresseDto.rue\" />\r\n            <input type=\"text\" name=\"ville\" class=\"form-control col-3\" placeholder=\"ville\"\r\n              v-model=\"form.adresseDto.ville\" />\r\n            <input type=\"text\" name=\"zipcode\" class=\"form-control col-3\" maxlength=\"5\" placeholder=\"code postale\"\r\n              v-model=\"form.adresseDto.codePostal\" />\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div>\r\n        <input type=\"submit\" value=\"Envoyer\" class=\"btn btn-outline-success float-right\" />\r\n      </div>\r\n    </form>\r\n\r\n    <!-- <EntrepriseListComponent\r\n        class=\"col-11\"\r\n        v-on:click-list=\"onClickChildEntrepriseList\"\r\n        :entrepriseProp=\"entreprise_input\"\r\n        :class=\"{ collapse: isEntrepriseNew }\"\r\n        /> -->\r\n \r\n    <RoleModal v-show=\"isModalVisible\" @close=\"closeModal\" :rolesProp=\"rolesComputed\" v-on:close=\"onClickClose\" />\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import moment from \"moment-timezone\";\r\n  import { utilisateurApi } from \"@/_api/utilisateur.api.js\";\r\n  import BodyTitle from \"@/components/utils/BodyTitle.vue\";\r\n  // import AdresseListComponent from \"@/components/List/AdresseListComponent.vue\";\r\n  // import EntrepriseListComponent from \"@/components/List/EntrepriseListComponent.vue\";\r\n  import RoleModal from \"@/components/Modal/RoleModal.vue\";\r\n\r\n  export default {\r\n    name: \"AddUser\",\r\n    components: {\r\n      BodyTitle,\r\n      // AdresseListComponent,\r\n      // EntrepriseListComponent,\r\n      RoleModal,\r\n    },\r\n    data() {\r\n      return {\r\n        btn_form_text: \"Ajouter\",\r\n        vue_title: \"Nouvel utilisateur\",\r\n\r\n        form: {\r\n          id: null,\r\n          prenom: \"\",\r\n          nom: \"\",\r\n          civilite: \"\",\r\n          dateDeNaissance: \"\",\r\n          telephone: \"\",\r\n          login: \"\",\r\n          password: \"\",\r\n          rolesDto: [],\r\n          adresseDto: {\r\n            id: null,\r\n            numero: \"\",\r\n            rue: \"\",\r\n            ville: \"\",\r\n            codePostal: \"\",\r\n          },\r\n          // entrepriseDto: {\r\n          //   id: null,\r\n          //   raisonSociale: \"\",\r\n          //   adresseSiegeDto: {\r\n          //     id: null,\r\n          //     numero: \"\",\r\n          //     rue: \"\",\r\n          //     ville: \"\",\r\n          //     codePostal: \"\",\r\n          //   },\r\n          // },\r\n        },\r\n\r\n        //On a des soucis si l'adresse de l'entreprise est null\r\n        //D'ou l'utilisation de cet objet\r\n        adresseEntreprise: {\r\n          id: null,\r\n          numero: \"\",\r\n          rue: \"\",\r\n          ville: \"\",\r\n          codePostal: \"\",\r\n        },\r\n\r\n        isModalVisible: false,\r\n\r\n        isAdresseNew: true,\r\n        isEntrepriseNew: true,\r\n\r\n        btn_adresse: \"Existante\",\r\n        btn_entreprise: \"Existante\",\r\n      };\r\n    },\r\n    computed: {\r\n      rolesComputed() {\r\n        return this.form.rolesDto;\r\n      },\r\n      adresse_input() {\r\n        return this.adresse;\r\n      },\r\n      entreprise_input() {\r\n        return this.entreprise;\r\n      },\r\n    },\r\n    methods: {\r\n      onClickChildAdresseList(adresse) {\r\n        this.form.adresseDto = adresse;\r\n      },\r\n      onClickChildEntrepriseList(entreprise) {\r\n        this.form.entrepriseDto = entreprise;\r\n      },\r\n      submit(e) {\r\n        e.preventDefault();\r\n\r\n        //Pour custom le message d'erreur\r\n        let login = document.getElementById(\"login\");\r\n        // let role = document.getElementById(\"role\");\r\n        // let password = document.getElementById('password');\r\n\r\n        // //On reset le message pour retest\r\n        // login.setCustomValidity(\"\");\r\n        // password.setCustomValidity(\"\");\r\n\r\n        // if(!this.testPassword(this.form.password)) {\r\n        //   console.log(\"je set password custom validity\");\r\n        //   password.setCustomValidity(\"Le mot de passe doit contenir au moins 8 caractères avec au moins une majuscule, une minuscule, un chiffre et un caractère spécial \");\r\n        //   password.reportValidity();\r\n        // }\r\n\r\n        //Si on ne donne pas d'entreprise, on la set a null pour ne rien save dans le back\r\n        // if(this.form.entrepriseDto.raisonSociale == \"\" && this.form.entrepriseDto.rue == \"\" && this.form.entrepriseDto.ville == \"\") this.form.entrepriseDto = null;\r\n\r\n        //Si on renseigne l'adresse de l'entreprise\r\n        if (\r\n          this.adresseEntreprise.numero != \"\" ||\r\n          this.adresseEntreprise.rue != \"\" ||\r\n          this.adresseEntreprise.ville != \"\" ||\r\n          this.adresseEntreprise.codePostal != \"\"\r\n        ) {\r\n          // this.form.entrepriseDto.adresseSiegeDto = this.adresseEntreprise;\r\n          // console.log(\"j'ai une entreprise\");\r\n        }\r\n\r\n        // ON SUBMIT =>  conversion jj/mm/aaaa vers aaaa-mm-jj\r\n        this.form.dateDeNaissance = this.backEndDateFormat(\r\n          this.form.dateDeNaissance\r\n        );\r\n        utilisateurApi\r\n          .save(this.form)\r\n          .then(() =>\r\n            this.$router.push({name: \"admin_dashboard\"}))\r\n          .catch((error) => {\r\n            // console.log(error.response.data);\r\n            if (\r\n              error.response.data ==\r\n              \"Un utilisateur utilise déjà cette adresse mail\"\r\n            ) {\r\n              login.setCustomValidity(\"Cette adresse mail est déjà utilisée\");\r\n              login.reportValidity();\r\n            }\r\n          });\r\n      },\r\n      showModal() {\r\n        this.isModalVisible = true;\r\n      },\r\n      closeModal() {\r\n        this.isModalVisible = false;\r\n      },\r\n      goBack() {\r\n        this.$router.go(-1);\r\n      },\r\n      onClickClose(roles) {\r\n        this.form.rolesDto = roles;\r\n      },\r\n      removeFromlist(index) {\r\n        this.form.rolesDto.splice(index, 1);\r\n      },\r\n      setAdresseVisibility() {\r\n        this.isAdresseNew = !this.isAdresseNew;\r\n        if (this.btn_adresse == \"Existante\") this.btn_adresse = \"Nouvelle\";\r\n        else this.btn_adresse = \"Existante\";\r\n      },\r\n      setEntrepriseVisibility() {\r\n        this.isEntrepriseNew = !this.isEntrepriseNew;\r\n        if (this.btn_entreprise == \"Existante\") this.btn_entreprise = \"Nouvelle\";\r\n        else this.btn_entreprise = \"Existante\";\r\n      },\r\n      testPassword(password) {\r\n        const regex = new RegExp(\r\n          \"^(?=.*[a-z])(?=.*[A-Z])(?=.*d)(?=.*[@$!%*?&])[A-Za-zd@$!%*?&]{8,}$\"\r\n        );\r\n        // console.log(\"regex.test() : \", regex.test(password));\r\n        return regex.test(password);\r\n      },\r\n      frontEndDateFormat(date) {\r\n        return moment(date, \"YYYY-MM-DD\").format(\"DD/MM/YYYY\");\r\n      },\r\n      backEndDateFormat(date) {\r\n        return moment(date, \"DD/MM/YYYY\").format(\"YYYY-MM-DD\");\r\n      },\r\n      // dateValidity(date){\r\n      //   const maxYear = new Date();\r\n      //   let dateInput = date.split(\"/\");\r\n      //   if(dateInput[0] >= 1 && dateInput <=31 && dateInput[1]>=1 && dateInput[1]<=12 && dateInput[1]>=1950 && dateInput[1]<= maxYear.getFullYear.toString() ) {\r\n      //     console.log(\"OK\");\r\n      //     console.log(date);\r\n      //     // date = this.backEndDateFormat(date);\r\n      //   }\r\n      // }\r\n    },\r\n    created() {\r\n      //Pour etre sur, dans le doute, on fait les 3 tests\r\n      if (\r\n        this.$route.params.id != null &&\r\n        this.$route.params.id != \"\" &&\r\n        this.$route.params.id != 0\r\n      ) {\r\n        utilisateurApi.getById(this.$route.params.id).then((response) => {\r\n          this.vue_title = \"Modifier l'utilisateur\";\r\n          this.btn_form_text = \"Modifier\";\r\n          this.form = response;\r\n\r\n          // Si id existant => conversion aaaa-mm-jj vers jj/mm/aaaa\r\n          this.form.dateDeNaissance = this.frontEndDateFormat(response.dateDeNaissance);\r\n\r\n          if (response.entrepriseDto.adresseSiegeDto != null)\r\n            this.adresseEntreprise = response.entrepriseDto.adresseSiegeDto;\r\n        });\r\n      }\r\n    },\r\n  };\r\n</script>\r\n\r\n<style scoped>\r\n  .header-list {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    margin-bottom: 0.5%;\r\n  }\r\n\r\n  .header-list>form {\r\n    width: 40%;\r\n  }\r\n\r\n  .civilite {\r\n    font-weight: bold;\r\n    margin-left: 1.7em;\r\n    margin-right: 3em;\r\n  }\r\n\r\n  #saisie {\r\n    width: 70%;\r\n    margin-right: 5%;\r\n  }\r\n\r\n  .croix-delete:hover {\r\n    cursor: pointer;\r\n  }\r\n</style>"]}]}